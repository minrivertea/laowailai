{% extends "base.html" %}
{% load thumbnail %}
{% load comments %}


{% block metadescription %}{{ this_laowai.name }}'s posts on LaoWaiLai - {{ this_laowai.bio }}{% endblock %}
{% block pagetitle %}{% ifequal this_laowai laowai %}Your{% else %}{{ this_laowai.name }}'s{% endifequal %} posts{% endblock %}

{% block extrajs %}
<script type="text/javascript" charset="utf-8">  

function bindPostCommentHandler(idx) {    
    $('#comment-form-' + idx + ' form').submit(function() {
    	if ($('#comment-form-' + idx + ' form textarea').val() == '') {
    		$('#comment-form-' + idx + ' form').prepend('<p class="warning" style="color:red; display:block;"><em>You must type something</em></p>');
    	}
    	else {
        $.ajax({  
            type: "POST",  
            data: $('#comment-form-' + idx + ' form').serialize(),  
            url: "{% comment_form_target %}",  
            cache: false,  
            dataType: "html",  
            success: function(data, textStatus) {
                $('#comments_full_' + idx + ' .comments-list').append(data);
                $('#comment-form-' + idx + ' textarea').val('');
                $('#comment-form-' + idx + ' .warning').attr('style', 'display:none');
            },  
            error: function (XMLHttpRequest, textStatus, errorThrown) {  
                $('#comment-form-' + idx + ' form').replaceWith('Your comment could not be posted.');  
            }  
        }); 
    	}
        return false;
    });  
}  
      
$(document).ready(function() { 
	{% for info, i_like in these_infos %} 
   	     bindPostCommentHandler({{ info.id }});
	{% endfor %}  
});  
</script>  
{% endblock %}




{% block extracss %}
<style type="text/css">
p.description {
  border-bottom: none;
  margin: 0;
  float: left;
  width: 430px;	
}

div#top div#photo {
  width: 100px;
  float: left;	
  margin-right: 30px;
  margin-bottom: 20px;
}

div#top div#photo p {
  font-weight: bold;
  font-size: 12px;
  margin: 0;	
}
</style>
{% endblock %}

{% block content %}
	
<div id="top">
	<div id="photo">
	{% if this_laowai.photo %}
		{% thumbnail this_laowai.photo "80x80" crop="center" as im %}
		<img class="profile-photo-large" title="{{ this_laowai.name }}" alt="{{ this_laowai.name }}'s photo" src="{{ im.url }}">
		{% endthumbnail %}
	{% else %}
		<img class="profile-photo-large" title="{{ this_laowai.name }}" alt="" src="/images/avatar_small.png">
	{% endif %}
	<p>{{ this_laowai.added_places.count }} place{{ this_laowai.added_places.count|pluralize }}</p>
	<p>{{ this_laowai.added_questions.count }} question{{ this_laowai.added_questions.count|pluralize }}</p>
	<p>{{ this_laowai.added_answers.count }} answer{{ this_laowai.added_answers.count|pluralize }}</p>
	{% ifequal this_laowai laowai %}
	<p>{{ this_laowai.profile_views }} profile view{{ this_laowai.profile_views|pluralize }}</p>
	{% endifequal %}
	</div>
	
	<h1>{% ifequal this_laowai laowai %}Your posts{% else %}All posts by {{ this_laowai.name }}{% endifequal %}</h1>

	<p class="description">
	{% if this_laowai.bio %}
			<em>{{ this_laowai.bio }}</em><br/>
			{% ifequal this_laowai laowai %}<span class="small"><a href="{% url add_a_bio %}">Edit bio</a></span>{% endifequal %}
	{% else %}
	    {% ifequal this_laowai laowai %}
	    	<a href="{% url add_a_bio %}">Add an introduction to yourself</a>
	    {% else %}
	    	<em>{{ this_laowai.name }} hasn't added an introduction yet</em>
		{% endifequal %}	
	{% endif %}
</div>
	
	
	<div id="feed">
	{% include "list/snippets/personal_feed.html" %}

	</div>
	





{% endblock %}

	{% block extra-content %}
	<div id="add-form">
	{% include "snippets/add-form.html" %}
	</div>
	{% endblock %}
