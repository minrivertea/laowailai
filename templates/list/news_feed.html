{% extends "base.html" %}
{% load thumbnail %}
{% load comments %}

{% block metadescription %}News, events and places to go for foreigners living or travelling in {{ city.name }}.{% endblock %}
{% block pagetitle %}News from {{ city }}{% endblock %}

{% block extrajs %}

<script type="text/javascript" charset="utf-8">  

function bindPostCommentHandler(idx) {   
	var thisObject = $('#comment-form-' + idx + ' form'); 
    thisObject.submit(function() {
    	if ($('textarea#id_comment_' + idx).val() == '') {
    		$(this).append('<p class="warning" style="color:red; display:block; float:right;position:relative;top:10px;"><em>You must type something!</em></p>');
    	}
    	else {
        	$.ajax({  
        	    type: "POST",  
        	    data: $('#comment-form-' + idx + ' form').serialize(),  
        	    url: "/comments/post/",  
        	    cache: false,  
        	    dataType: "html",  
        	    success: function(data, textStatus) {
        	        $('#comments_full_' + idx + ' .comments-list').append(data);
        	        $('#comment-form-' + idx + ' textarea').val('');
        	        $('#comment-form-' + idx + ' .warning').attr('style', 'display:none');
        	    },  
        	    error: function (XMLHttpRequest, textStatus, errorThrown) {  
        	        thisObject.replaceWith('Your comment could not be posted.');  
        	    }  
        	}); 
        	
        	$().ajaxStart(function(){
   				$('.submit').css('opacity', '0.4');
 			});
 			$().ajaxStop(function(){
   				$('.submit').css('opacity', '1');
 			});
    	}
        return false;
    });  
} 


function showComments(id) {
  	bindPostCommentHandler(id);
    $("div#comments_full_" + id).toggle();
    $("span.show_comments" + id).removeAttr("onclick");	
}


function nextPage(page) {
$.getJSON("/{{ city.slug }}/feed/", {xhr: "true", page: page},
  function(data) {
  	$(data).appendTo('#feed ul');
  	pageNum++; 
  });
}

var pageNum = {{ objects.next_page_number }}
$("#pagination").click(function () { 
	nextPage(pageNum); 
});

$("textarea").focus(function() {
    if( $(this).text() == "Write something on the wall..." ) {
        $(this).text("");
    }

});

$("textarea").blur(function() {

    if( $(this).text() == "" ) {
        $(this).text("Write something on the wall...");
    }

});

$("#loading").ajaxStart(function(){
   $('#pagination').hide();
   $(this).show();
 });

$("#loading").ajaxStop(function(){
   $(this).hide();
   $('#pagination').show();
 });
 
 
$("#id_content").focus(function() {
	$(this).animate({"height": "85px",}, "fast" );
	$("#button-block").slideDown("fast");
  return false;
});

$("#cancel").click(function() {
	  $(this).animate({"height": "20px",}, "fast" );
	  $("#button-block").slideUp("fast");
	  $("#button-block").css('display', 'none');
    return false;
});

$('#image-question').click(function() {
	$(this).toggle();
	$("#button-block").slideDown("fast");
	$('#image-field').toggle();
});
  
      
$(document).ready(function() { 
	$("a.image").fancybox();
});  

</script>  

<script type="application/javascript" src="/js/lightbox/jquery.fancybox-1.3.4.pack.js"></script>
{% endblock %}


{% block extracss %}


<link rel="stylesheet" href="/css/fancybox/jquery.fancybox-1.3.4.css" />

<style type="text/css">
div#introduction {
  height: 300px;
  float: left;	
}

span.like {
 color: #2D7886;	
}

span.like:hover {
  color: #F67B7B;
  cursor: pointer;	
}

div#pagination {
    background-color: #E6E6E6;
    
    /* Firefox 3.6+ */ 
    background: -moz-linear-gradient(100% 100% 90deg, #e6e6e6, #f1f1f1); 
    
    /* Safari 4-5, Chrome 1-9 */ /* -webkit-gradient(<type>, <point> [, <radius>]?, <point> [, <radius>]? [, <stop>]*) */ 
    background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#f1f1f1), to(#e6e6e6)); 
    
    /* Safari 5.1+, Chrome 10+ */ 
    background: -webkit-linear-gradient(#e6e6e6, #f1f1f1); 
    
    /* Opera 11.10+ */ background: -o-linear-gradient(#e6e6e6, #f1f1f1);   
    
    border: 1px solid #d1d1d1;
    border-radius: 2px 2px 2px 2px;
    color: #2D7886;
    float: left;
    font-size: 12px;
    font-weight: bold;
    margin-bottom: 40px;
    padding: 15px 0;
    text-align: center;
    width: 100%;
}

div#pagination:hover {
  cursor: pointer;
  background-color: #e1e1e1;
  color: #F67B7B;	
}

div#add-form {
    float: left;
    width: 530px;
}

div#add-form textarea {
  width: 540px;
  height: 20px;
  padding: 10px;
  font-size: 13px;
  color: #666;
  line-height: 1.4em;
  border: 1px solid #e1e1e1;
  margin-bottom: 0px;	
}

div#add-form textarea:focus {
  border: 1px solid #999;	
}

div#add-form input.submit-button {
  margin: 10px 18px 0 0;	
}

div#add-form form {
    background-color: #F6F6F6;
    float: left;
    margin: 0 0 30px -30px;
    padding: 15px 30px;
    width: 580px;
}

div#add-form h4 {
  margin: 0 0 5px 0;
  color: #666;	
  font-size: 0.8em;
}

div#add-form div.form-left h4 {
  color: black;	
}


div#add-form label {
  margin: 0;
  color: #666;
  font-weight: normal;
  font-size: 0.9em;
}

div#add-form p.small {
  font-size: 0.7em;
  margin: 0;
  padding: 0;	
}

#button-block {
  display: none;	
}

div#add-form div.options p {
  float: left;
  font-weight: bold;
  padding: 0 20px;
  position: relative;
  top: 5px;	
}

div#add-form div.options p.selected {
    background-color: #F6F6F6;
    padding: 5px 20px 2px;
    top: 0px;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
}

div#add-form div#image-question {
  font-size: 12px;
  font-weight: bold;
  float: left;
  margin-top: 10px;
  color: #2D7886;	
}

div#add-form div#image-question:hover {
  cursor: pointer;
  color: #F67B7B;	
}

div#add-form div#image-question span {
  position: relative;
  top: -7px;	
}

div#add-form div#image-question img {
  margin-right: 5px;
}

div#add-form div#image-field {
   font-size: 12px;
   font-weight: bold;
   margin-top: 10px;
   float: left;
   width: 310px;	
}

a.delete {
  float: right;
  font-size: 11px;
  font-weight: bold;
  display:none;	
  padding: 5px;
  background-color: #f1f1f1;
}

a.delete:hover {
  background-color: #DFECF1;	
}

div#feed ul li:hover a.delete {
  display: block;	
}

</style>
{% endblock %}

{% block content %}
	
<div id="top">
<h1>News from {{ city }}</h1>
{% if request.user.is_authenticated %}
{% else %}
	<p class="signup"><a href="{% url registration_register %}"><strong>Signup</strong></a> or <a href="/accounts/login/"><strong>login</strong></a> to add your news</p>
	{% endif %}
</div>

	
	<div id="feed">
		{% include "list/snippets/feed.html" %}
	</div>





{% endblock %}
