{% extends "base.html" %}
{% load thumbnail %}
{% load comments %}

{% block metadescription %}The best place to share news and events for foreigners in {{ current_city }}, China.{% endblock %}
{% block pagetitle %}News from {{ current_city }}{% endblock %}

{% block extrajs %}
<script type="text/javascript" charset="utf-8">  

function bindPostCommentHandler(idx) {    
    $('#comment-form-' + idx + ' form').submit(function() {
    	if ($('#comment-form-' + idx + ' form textarea').val() == '') {
    		$('#comment-form-' + idx + ' form').prepend('<p class="warning" style="color:red; display:block;"><em>You must type something</em></p>');
    	}
    	else {
        $.ajax({  
            type: "POST",  
            data: $('#comment-form-' + idx + ' form').serialize(),  
            url: "{% comment_form_target %}",  
            cache: false,  
            dataType: "html",  
            success: function(data, textStatus) {
                $('#comments_full_' + idx + ' .comments-list').append(data);
                $('#comment-form-' + idx + ' textarea').val('');
                $('#comment-form-' + idx + ' .warning').attr('style', 'display:none');
            },  
            error: function (XMLHttpRequest, textStatus, errorThrown) {  
                $('#comment-form-' + idx + ' form').replaceWith('Your comment could not be posted.');  
            }  
        }); 
    	}
        return false;
    });  
}  
      
$(document).ready(function() { 
	{% for info, i_like in objects %} 
   	     bindPostCommentHandler({{ info.id }});
	{% endfor %}  
});  
</script>  
{% endblock %}


{% block extracss %}
<style type="text/css">
div#introduction {
  height: 300px;
  float: left;	
}
</style>
{% endblock %}

{% block content %}
	
<div id="top">
<h1>News from {{ city }}</h1>
</div>
<p class="description">This is a feed of news and info from {{ city }} - it's posted by the <em>laowai</em> that live here!</p>
	
	
	<div id="feed">
		{% include "list/snippets/feed.html" %}
	</div>





{% endblock %}

{% block extra-content %}
	    {% if user.is_authenticated %}
			<div id="add-form">
			<img class="arrow" src="/images/arrow.png"/>
				{% include "list/snippets/add-form.html" %}
			</div>
		{% else %}
			<div id="add-form">
			<h4>You need to <a title="Signup to add posts to the mailing list and add comments" href="{% url registration_register %}">signup</a> to add your own news</h4>
			</div>
		{% endif %}
{% endblock %}
