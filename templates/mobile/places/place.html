{% extends "base.html" %}
{% load comments %}
{% load thumbnail %}

{% block metadescription %}{{ place.description|safe }}{% endblock %}
{% block pagetitle %}{{ place.name }} - {{ place.city }}{% endblock %}

{% block canonical %}
<link rel="canonical" href="{{ place.canonical_url }}" />
{% endblock %}


{% block extrajs %}

<script type="text/javascript">

function bindPostCommentHandler() {    
    $('#comment-form form').submit(function() {
    	if ($('#comment-form form textarea').val() == '') {
    		$('#comment-form form').prepend('<p class="warning" style="color:red; display:block;"><em>You must type something</em></p>');
    	}
    	else {
        $.ajax({  
            type: "POST",  
            data: $('#comment-form form').serialize(),  
            url: "{% comment_form_target %}",  
            cache: false,  
            dataType: "html",  
            success: function(data, textStatus) {
                $('.comments').append(data);
                $('#comment-form textarea').val('');
                $('#comment-form .warning').attr('style', 'display:none');
            },  
            error: function (XMLHttpRequest, textStatus, errorThrown) {  
                $('#comment-form form').replaceWith('Your comment could not be posted.');  
            }  
        }); 
    	}
        return false;
    });  
}  


function verifyPlace() {
    $.getJSON("{% url verify_place place.city.slug place.id %}", {xhr: "true"},
      function(data) {
      if (data.success == true) {
          $('#verify a.button').replaceWith('<span class="button already-verified">Verified by you!</span>');
          $('#verify #num').replaceWith(data.num);
      }
      else {
      	
      }
  	});
}
      
$(document).ready(function() { 
    bindPostCommentHandler(); 
    $('#verify a.button').attr('href', '#');
    $('#verify a.button').click(verifyPlace);
	$("#photos a.image").fancybox();
    $('#social-proof').fancybox({
    	'autoDimensions':false,
    	'width':600,
    	'padding': 30,
    });
});  


   
 
</script> 


 

<script type="application/javascript" src="/js/lightbox/jquery.fancybox-1.3.4.pack.js"></script>
{% endblock %}




{% block extracss %}
<link rel="stylesheet" href="/css/fancybox/jquery.fancybox-1.3.4.css" />
<style type="text/css">

p.description {
  font-family: Georgia, serif;	
}

.whitebox p {
  padding: 10px;	
}

#infobar {
  margin-left: 10px	;
  float:left;
}


div.ratings {
  float: ;	
}

div.ratings p {
  font-size: 10px;
  margin: 0;
  text-align: ;	
}

	/*             styles for the star rater                */	
	.star-rating{
		list-style:none;
		margin: 0px;
		padding:0px;
		width: 125px;
		height: 25px;
		position: relative;
		overflow:hidden;
		background: url("/images/alt_star2.png") top left repeat-x;		
	}
	.star-rating li{
		padding:0px;
		margin:0px;
		width:25px;
		height:25px;
		/*\*/
		float: left;
		/* */
	}
	.star-rating li a{
		display:block;
		width:25px;
		height: 25px;
		line-height:25px;		
		text-decoration: none;
		text-indent: -9000px;
		z-index: 20;
		position: absolute;
		padding: 0px;
		overflow:hidden;
	}
	.star-rating li a:hover{
		background: url("/images/alt_star2.png") left bottom;
		z-index: 2;
		left: 0px;
		border:none;
	}
	.star-rating a.one-star{
		left: 0px;
	}
	.star-rating a.one-star:hover{
		width:25px;
	}
	.star-rating a.two-stars{
		left:25px;
	}
	.star-rating a.two-stars:hover{
		width: 50px;
	}
	.star-rating a.three-stars{
		left: 50px;
	}
	.star-rating a.three-stars:hover{
		width: 75px;
	}
	.star-rating a.four-stars{
		left: 75px;
	}	
	.star-rating a.four-stars:hover{
		width: 100px;
	}
	.star-rating a.five-stars{
		left: 100px;
	}
	.star-rating a.five-stars:hover{
		width: 125px;
	}
	.star-rating li.current-rating{
		background: url("/images/alt_star2.png") left center;
		position: absolute;
		height: 25px;
		display: block;
		text-indent: -9000px;
		z-index: 1;
	}
	
	/* remove halo effect in firefox   */
	a:active{
		outline: none;
	}	
	
div#filters ul {
  margin:0;
  padding: 0;
  list-style-type: none;
  display: inline;	
}

div#filters li a {
  float: left;
  height: 32px;
  width: 32px;
  margin-right: 10px;	
}

div#filters li a span {
  font-size: 11px;
  font-weight: bold;
  position: relative;
  top: 35px;
  display: block;
  width: 100%;
  text-align: center;
  color: #333;	
}	


div#filters li.eat a {
  background: url('/images/eat_small.png') no-repeat top left;
}

div#filters li.drink a {
  background: url('/images/drink_small.png') no-repeat top left;
}

div#filters li.do a {
  background: url('/images/do_small.png') no-repeat top left;
}

div#filters li.see a {
  background: url('/images/see_small.png') no-repeat top left;
}

div#filters li.buy a {
  background: url('/images/buy_small.png') no-repeat top left;
}



</style>

{% endblock %}

{% block content %}

<div id="main">

	<h2>{{ place.name }} ({{ place.chinese_name }})</h2>

	<div class="whitebox">
	
		<p class="description">{{ place.description }}</p>
		<p><strong>Location - <a href="">view on map</a></strong><br/> {{ place.location }}</p>
	
	
		<div id="infobar">
			<div class="ratings">
			{% if rated %}
			<p>You've rated this (avg. {{ place.get_average_rating }}/5)</p>
			<ul class="star-rating">
				<li class="current-rating" style="width:{{ current_rating }}px;"> Currently 3.5/5 Stars.</li>
			</ul>
			{% else %}
			
			<p>{{ place.rating_count }} rating{{ place.rating_count|pluralize }} (avg. {{ place.get_average_rating }}/5)</p>
			<ul class="star-rating">
				<li class="current-rating" style="width:{{ current_rating }}px;"> Currently 3.5/5 Stars.</li>
				{% if request.user.is_authenticated %}
				<li><a href="{% url add_rating city.slug place.slug %}?rating=1" title="1 star out of 5" class="one-star">1</a></li>
				<li><a href="{% url add_rating city.slug place.slug %}?rating=2" title="2 stars out of 5" class="two-stars">2</a></li>
				<li><a href="{% url add_rating city.slug place.slug %}?rating=3" title="3 stars out of 5" class="three-stars">3</a></li>
				<li><a href="{% url add_rating city.slug place.slug %}?rating=4" title="4 stars out of 5" class="four-stars">4</a></li>
				<li><a href="{% url add_rating city.slug place.slug %}?rating=5" title="5 stars out of 5" class="five-stars">5</a></li>
				{% endif %}
			</ul>
			
			{% endif %}
		</div>

	</div>
	
	<div id="choices">
		<a href="">View on a map<img src="/images/mobile/rarrow.png"></a>
		{% with place as object %}
		{% get_comment_count for object as comment_count %}
		<a href="">View comments ({{ comment_count }})<img src="/images/mobile/rarrow.png"></a>
		{% endwith %}
	
	</div>

	
</div>


	


		


{% endblock %}
